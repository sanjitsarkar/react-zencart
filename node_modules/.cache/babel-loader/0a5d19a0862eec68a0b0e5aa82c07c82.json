{"ast":null,"code":"import { Response } from \"miragejs\";\n\nconst jwt = require(\"jsonwebtoken\");\n\nimport dayjs from \"dayjs\";\nexport const requiresAuth = function (request) {\n  const encodedToken = request.requestHeaders.authorization;\n  const decodedToken = jwt.verify(encodedToken, process.env.REACT_APP_JWT_SECRET);\n\n  if (decodedToken) {\n    const user = this.db.users.findBy({\n      email: decodedToken.email\n    });\n\n    if (user) {\n      return user._id;\n    }\n  }\n\n  return new Response(401, {}, {\n    errors: [\"The token is invalid. Unauthorized access error.\"]\n  });\n};\nexport const formatDate = () => dayjs().format(\"YYYY-MM-DDTHH:mm:ssZ\");","map":{"version":3,"sources":["/home/xanjit/Desktop/neog/react-ecom/src/backend/utils/authUtils.js"],"names":["Response","jwt","require","dayjs","requiresAuth","request","encodedToken","requestHeaders","authorization","decodedToken","verify","process","env","REACT_APP_JWT_SECRET","user","db","users","findBy","email","_id","errors","formatDate","format"],"mappings":"AAAA,SAASA,QAAT,QAAyB,UAAzB;;AACA,MAAMC,GAAG,GAAGC,OAAO,CAAC,cAAD,CAAnB;;AACA,OAAOC,KAAP,MAAkB,OAAlB;AAEA,OAAO,MAAMC,YAAY,GAAG,UAAUC,OAAV,EAAmB;AAC7C,QAAMC,YAAY,GAAGD,OAAO,CAACE,cAAR,CAAuBC,aAA5C;AACA,QAAMC,YAAY,GAAGR,GAAG,CAACS,MAAJ,CACnBJ,YADmB,EAEnBK,OAAO,CAACC,GAAR,CAAYC,oBAFO,CAArB;;AAIA,MAAIJ,YAAJ,EAAkB;AAChB,UAAMK,IAAI,GAAG,KAAKC,EAAL,CAAQC,KAAR,CAAcC,MAAd,CAAqB;AAAEC,MAAAA,KAAK,EAAET,YAAY,CAACS;AAAtB,KAArB,CAAb;;AACA,QAAIJ,IAAJ,EAAU;AACR,aAAOA,IAAI,CAACK,GAAZ;AACD;AACF;;AACD,SAAO,IAAInB,QAAJ,CACL,GADK,EAEL,EAFK,EAGL;AAAEoB,IAAAA,MAAM,EAAE,CAAC,kDAAD;AAAV,GAHK,CAAP;AAKD,CAjBM;AAmBP,OAAO,MAAMC,UAAU,GAAG,MAAMlB,KAAK,GAAGmB,MAAR,CAAe,sBAAf,CAAzB","sourcesContent":["import { Response } from \"miragejs\";\nconst jwt = require(\"jsonwebtoken\");\nimport dayjs from \"dayjs\";\n\nexport const requiresAuth = function (request) {\n  const encodedToken = request.requestHeaders.authorization;\n  const decodedToken = jwt.verify(\n    encodedToken,\n    process.env.REACT_APP_JWT_SECRET\n  );\n  if (decodedToken) {\n    const user = this.db.users.findBy({ email: decodedToken.email });\n    if (user) {\n      return user._id;\n    }\n  }\n  return new Response(\n    401,\n    {},\n    { errors: [\"The token is invalid. Unauthorized access error.\"] }\n  );\n};\n\nexport const formatDate = () => dayjs().format(\"YYYY-MM-DDTHH:mm:ssZ\");\n"]},"metadata":{},"sourceType":"module"}